<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Turnieje FC 26</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Turnieje FC 26</h1>

  <div id="auth" class="card">
    <h2>Logowanie</h2>
    <input id="loginInput" placeholder="login">
    <input id="passwordInput" type="password" placeholder="has≈Ço">
    <button onclick="doLogin()">Zaloguj</button>

    <h2>Rejestracja</h2>
    <input id="regLogin" placeholder="login">
    <input id="regPassword" type="password" placeholder="has≈Ço">
    <button onclick="doRegister()">Zarejestruj</button>
    <p id="msg"></p>
  </div>

  <div id="panel" style="display:none">
    <div class="card">
      <p id="me"></p>
      <button class="gray" onclick="doLogout()">Wyloguj</button>
    </div>

    <div id="matches"></div>
    <div id="adminPanel"></div>
  </div>
</div>

<script>
const msg = document.getElementById("msg");

async function api(url, data) {
  const r = await fetch(url, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const j = await r.json();
  if (!r.ok) throw j;
  return j;
}

async function doLogin() {
  try {
    await api("/api/login",{
      login: loginInput.value,
      password: passwordInput.value
    });
    load();
  } catch(e){ msg.innerText=e.error; }
}

async function doRegister() {
  try {
    await api("/api/register",{
      login: regLogin.value,
      password: regPassword.value
    });
    msg.innerText="Zarejestrowano";
  } catch(e){ msg.innerText=e.error; }
}

async function doLogout(){
  await api("/api/logout",{});
  load();
}

async function load(){
  const me = await fetch("/api/me").then(r=>r.json());
  if(!me.logged){
    auth.style.display="block";
    panel.style.display="none";
    return;
  }

  auth.style.display="none";
  panel.style.display="block";
  document.getElementById("me").innerText =
    `${me.login} | Saldo: ${me.saldo} üí∞`;

  const matches = await fetch("/api/matches").then(r=>r.json());
  document.getElementById("matches").innerHTML =
    matches.map(m=>`
      <div class="card match">
        <b>${m.a} vs ${m.b}</b>
        <span>Status: ${m.status}</span>
        ${m.status==="open" ? `
          <button onclick="bet(${m.id},'a')">A</button>
          <button onclick="bet(${m.id},'b')">B</button>
        ` : ``}
      </div>
    `).join("");

  if(me.admin){
    adminPanel.innerHTML = `
      <div class="card admin">
        <h2>Panel Admina</h2>
        <input id="a" placeholder="Gracz A">
        <input id="b" placeholder="Gracz B">
        <button onclick="addMatch()">Dodaj mecz</button>
        <hr>
        <input id="mid" placeholder="ID meczu">
        <select id="res">
          <option value="a">Wygrywa A</option>
          <option value="b">Wygrywa B</option>
          <option value="draw">Remis</option>
        </select>
        <button class="green" onclick="finish()">Zako≈Ñcz mecz</button>
        <button class="red" onclick="cancel()">Anuluj mecz</button>
      </div>
    `;
  }
}

async function bet(id,t){
  const amount = prompt("Kwota");
  await api("/api/bet",{matchId:id,team:t,amount:+amount});
  load();
}

async function addMatch(){
  await api("/api/admin/match",{a:a.value,b:b.value});
  load();
}

async function finish(){
  await api("/api/admin/finish",{id:+mid.value,result:res.value});
  load();
}

async function cancel(){
  await api("/api/admin/cancel",{id:+mid.value});
  load();
}

load();
</script>
</body>
</html>
