<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Turnieje FC 26</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Turnieje FC 26</h1>

  <div id="auth" class="card">
    <h2>Logowanie</h2>
    <input id="loginInput" placeholder="login">
    <input id="passwordInput" type="password" placeholder="has≈Ço">
    <button onclick="doLogin()">Zaloguj</button>

    <h2>Rejestracja</h2>
    <input id="rloginInput" placeholder="login">
    <input id="rpasswordInput" type="password" placeholder="has≈Ço">
    <button onclick="doRegister()">Zarejestruj</button>

    <p id="msg"></p>
  </div>

  <div id="panel" style="display:none">
    <div class="card">
      <p id="me"></p>
      <button onclick="logout()">Wyloguj</button>
    </div>

    <div id="matches"></div>
    <div id="admin"></div>
  </div>
</div>

<script>
const msg = document.getElementById("msg");

async function api(url, data) {
  const r = await fetch(url, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const j = await r.json();
  if (!r.ok) throw j;
  return j;
}

async function doLogin() {
  msg.innerText = "";
  try {
    await api("/api/login", {
      login: document.getElementById("loginInput").value,
      password: document.getElementById("passwordInput").value
    });
    load();
  } catch(e) {
    msg.innerText = e.error || "B≈ÇƒÖd logowania";
  }
}

async function doRegister() {
  msg.innerText = "";
  try {
    await api("/api/register", {
      login: document.getElementById("rloginInput").value,
      password: document.getElementById("rpasswordInput").value
    });
    msg.innerText = "Zarejestrowano pomy≈õlnie";
  } catch(e) {
    msg.innerText = e.error || "B≈ÇƒÖd rejestracji";
  }
}

async function logout() {
  await api("/api/logout", {});
  load();
}

async function load() {
  const me = await fetch("/api/me").then(r=>r.json());

  if(!me.logged){
    auth.style.display="block";
    panel.style.display="none";
    return;
  }

  auth.style.display="none";
  panel.style.display="block";
  document.getElementById("me").innerText =
    `${me.login} | Saldo: ${me.saldo} üí∞`;

  const matches = await fetch("/api/matches").then(r=>r.json());
  document.getElementById("matches").innerHTML =
    matches.map(m=>`
      <div class="card match">
        <b>${m.a} vs ${m.b}</b>
        <p>Status: ${m.status}</p>
        ${m.status==="open" ? `
          <button onclick="bet(${m.id},'a')">${m.a}</button>
          <button onclick="bet(${m.id},'b')">${m.b}</button>
          <button onclick="bet(${m.id},'draw')">Remis</button>
        ` : ``}
      </div>
    `).join("");

  if(me.admin){
    admin.innerHTML = `
      <div class="card admin">
        <h2>Panel Admina</h2>
        <input id="a" placeholder="Gracz A">
        <input id="b" placeholder="Gracz B">
        <button onclick="addMatch()">Dodaj mecz</button>

        <hr>

        <input id="mid" placeholder="ID meczu">
        <button onclick="finish('a')">Wygrywa A</button>
        <button onclick="finish('b')">Wygrywa B</button>
        <button onclick="finish('draw')">Remis</button>
        <button onclick="cancelMatch()">Anuluj mecz</button>
      </div>
    `;
  }
}

async function bet(id,t){
  const amount = +prompt("Kwota zak≈Çadu");
  if(!amount) return;
  await api("/api/bet",{matchId:id,team:t,amount});
  load();
}

async function addMatch(){
  await api("/api/admin/match",{a:a.value,b:b.value});
  load();
}

async function finish(r){
  await api("/api/admin/finish",{id:+mid.value,result:r});
  load();
}

async function cancelMatch(){
  await api("/api/admin/cancel",{id:+mid.value});
  load();
}

load();
</script>

</body>
</html>
