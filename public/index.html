<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Turnieje FC 26</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
<h1>Turnieje FC 26</h1>

<div id="auth">
<input id="login" placeholder="login">
<input id="password" type="password">
<button onclick="login()">Zaloguj</button>

<input id="rlogin" placeholder="login">
<input id="rpassword" type="password">
<button onclick="register()">Rejestracja</button>
<p id="msg"></p>
</div>

<div id="panel" style="display:none">
<p id="me"></p>
<button onclick="logout()">Wyloguj</button>

<div id="matches"></div>
<div id="admin"></div>
</div>
</div>

<script>
async function api(u,d){const r=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!r.ok)throw await r.json();return r.json();}
async function login(){try{await api("/api/login",{login:login.value,password:password.value});load();}catch(e){msg.innerText=e.error}}
async function register(){try{await api("/api/register",{login:rlogin.value,password:rpassword.value});msg.innerText="OK";}catch(e){msg.innerText=e.error}}
async function logout(){await api("/api/logout",{});load();}

async function load(){
const me=await fetch("/api/me").then(r=>r.json());
if(!me.logged){auth.style.display="block";panel.style.display="none";return;}
auth.style.display="none";panel.style.display="block";
meEl.innerText=`${me.login} | ${me.saldo} ðŸ’°`;

const m=await fetch("/api/matches").then(r=>r.json());
matches.innerHTML=m.map(x=>`
<div>
<b>${x.a} vs ${x.b}</b> (${x.status})
${x.status==="open"?`
<button onclick="bet(${x.id},'a')">${x.a}</button>
<button onclick="bet(${x.id},'b')">${x.b}</button>
<button onclick="bet(${x.id},'draw')">Remis</button>`:""}
</div>`).join("");

if(me.admin){
admin.innerHTML=`
<input id="a"><input id="b">
<button onclick="add()">Dodaj mecz</button>
<input id="mid"><button onclick="fin('a')">A</button>
<button onclick="fin('b')">B</button>
<button onclick="fin('draw')">Remis</button>
<button onclick="can()">Anuluj</button>`;
}
}

async function bet(id,t){
const a=+prompt("Kwota");
await api("/api/bet",{matchId:id,team:t,amount:a});load();
}
async function add(){await api("/api/admin/match",{a:a.value,b:b.value});load();}
async function fin(r){await api("/api/admin/finish",{id:+mid.value,result:r});load();}
async function can(){await api("/api/admin/cancel",{id:+mid.value});load();}

load();
</script>
</body>
</html>
