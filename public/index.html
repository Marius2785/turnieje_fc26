<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Turnieje FC 26</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Turnieje FC 26</h1>

<div id="msg" style="color:red;"></div>

<div id="auth">
  <h2>Logowanie</h2>
  <input id="login" placeholder="login">
  <input id="password" type="password" placeholder="hasÅ‚o">
  <button onclick="loginUser()">Zaloguj</button>

  <h2>Rejestracja</h2>
  <input id="rlogin" placeholder="login">
  <input id="rpassword" type="password" placeholder="hasÅ‚o">
  <button onclick="registerUser()">Zarejestruj</button>
</div>

<div id="panel" style="display:none">
  <p id="me"></p>
  <button onclick="logout()">Wyloguj</button>

  <h2>Mecze</h2>
  <div id="matches"></div>

  <div id="admin"></div>
</div>

<script>
async function post(url, data) {
  const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  const json = await res.json();
  if (!res.ok) throw json;
  return json;
}

function show(msg, ok=false) {
  const el = document.getElementById("msg");
  el.style.color = ok ? "green" : "red";
  el.innerText = msg;
}

async function loginUser() {
  try {
    await post("/api/login", {
      login: login.value,
      password: password.value
    });
    show("Zalogowano âœ”", true);
    load();
  } catch (e) {
    show(e.error || "BÅ‚Ä…d logowania");
  }
}

async function registerUser() {
  try {
    await post("/api/register", {
      login: rlogin.value,
      password: rpassword.value
    });
    show("Rejestracja udana âœ”", true);
  } catch (e) {
    show(e.error || "BÅ‚Ä…d rejestracji");
  }
}

async function logout() {
  await post("/api/logout", {});
  load();
}

async function load() {
  const res = await fetch("/api/me");
  const me = await res.json();

  if (!me.logged) {
    auth.style.display = "block";
    panel.style.display = "none";
    return;
  }

  auth.style.display = "none";
  panel.style.display = "block";
  me.textContent = `${me.login} | Saldo: ${me.saldo} ðŸ’°`;

  const matches = await fetch("/api/matches").then(r => r.json());
  document.getElementById("matches").innerHTML =
    matches.map(m =>
      `<div>
        ${m.a} vs ${m.b}
        ${m.open ? `
        <button onclick="bet(${m.id},'a')">Obstaw A</button>
        <button onclick="bet(${m.id},'b')">Obstaw B</button>` :
        `ZamkniÄ™ty`}
      </div>`
    ).join("");

  if (me.admin) {
    admin.innerHTML = `
      <h2>ADMIN</h2>
      <input id="a" placeholder="Gracz A">
      <input id="b" placeholder="Gracz B">
      <button onclick="addMatch()">Dodaj mecz</button>
    `;
  }
}

async function bet(id, team) {
  const amount = prompt("Kwota");
  try {
    await post("/api/bet", { matchId: id, team, amount: Number(amount) });
    load();
  } catch (e) {
    show(e.error || "BÅ‚Ä…d obstawiania");
  }
}

async function addMatch() {
  await post("/api/admin/match", { a: a.value, b: b.value });
  load();
}

load();
</script>
</body>
</html>
